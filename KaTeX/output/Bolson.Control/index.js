// Generated by purs version 0.15.9
import * as $foreign from "./foreign.js";
import * as Bolson_Core from "../Bolson.Core/index.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Apply from "../Control.Apply/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Category from "../Control.Category/index.js";
import * as Control_Lazy from "../Control.Lazy/index.js";
import * as Control_Monad_ST_Internal from "../Control.Monad.ST.Internal/index.js";
import * as Control_Plus from "../Control.Plus/index.js";
import * as Control_Semigroupoid from "../Control.Semigroupoid/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_FastVect_FastVect from "../Data.FastVect.FastVect/index.js";
import * as Data_Filterable from "../Data.Filterable/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_FunctorWithIndex from "../Data.FunctorWithIndex/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as FRP_Event from "../FRP.Event/index.js";
import * as FRP_Event_Class from "../FRP.Event.Class/index.js";
import * as Foreign_Object from "../Foreign.Object/index.js";
import * as Record_Builder from "../Record.Builder/index.js";
import * as Type_Proxy from "../Type.Proxy/index.js";
import * as Unsafe_Coerce from "../Unsafe.Coerce/index.js";
var mapAccum = /* #__PURE__ */ FRP_Event_Class.mapAccum(FRP_Event.eventIsEvent);
var keepLatest = /* #__PURE__ */ FRP_Event_Class.keepLatest(FRP_Event.eventIsEvent);
var map = /* #__PURE__ */ Data_Functor.map(FRP_Event.functorEvent);
var merge = /* #__PURE__ */ FRP_Event.merge(Data_Foldable.foldableArray);
var filter = /* #__PURE__ */ Data_Filterable.filter(FRP_Event.filterableEvent);
var eq = /* #__PURE__ */ Data_Eq.eq(Data_Eq.eqInt);
var pure = /* #__PURE__ */ Control_Applicative.pure(FRP_Event.applicativeEvent);
var bind = /* #__PURE__ */ Control_Bind.bind(Control_Monad_ST_Internal.bindST);
var voidLeft = /* #__PURE__ */ Data_Functor.voidLeft(Data_Functor.functorArray);
var toArray = /* #__PURE__ */ Data_FastVect_FastVect.toArray();
var empty = /* #__PURE__ */ Control_Plus.empty(FRP_Event.plusEvent);
var mapWithIndex = /* #__PURE__ */ Data_FunctorWithIndex.mapWithIndex(Data_FunctorWithIndex.functorWithIndexArray);
var fix = /* #__PURE__ */ Control_Lazy.fix(Control_Lazy.lazyFn);
var pure1 = /* #__PURE__ */ Control_Applicative.pure(Control_Monad_ST_Internal.applicativeST);
var map1 = /* #__PURE__ */ Data_Functor.map(Control_Monad_ST_Internal.functorST);
var map2 = /* #__PURE__ */ Data_Functor.map(Data_FastVect_FastVect.functorVect);
var for_ = /* #__PURE__ */ Data_Foldable.for_(Control_Monad_ST_Internal.applicativeST);
var for_1 = /* #__PURE__ */ for_(Data_Foldable.foldableMaybe);
var composeFlipped = /* #__PURE__ */ Control_Semigroupoid.composeFlipped(Record_Builder.semigroupoidBuilder);
var insert = /* #__PURE__ */ Record_Builder.insert()()({
    reflectSymbol: function () {
        return "id";
    }
});
var modify = /* #__PURE__ */ Record_Builder.modify()()({
    reflectSymbol: function () {
        return "parent";
    }
});
var $$void = /* #__PURE__ */ Data_Functor["void"](Control_Monad_ST_Internal.functorST);
var when = /* #__PURE__ */ Control_Applicative.when(Control_Monad_ST_Internal.applicativeST);
var for_2 = /* #__PURE__ */ for_(Data_Foldable.foldableArray);
var identity = /* #__PURE__ */ Control_Category.identity(Control_Category.categoryFn);
var map3 = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var append = /* #__PURE__ */ Data_Semigroup.append(/* #__PURE__ */ Control_Monad_ST_Internal.semigroupST(Data_Semigroup.semigroupString));
var traverse_ = /* #__PURE__ */ Data_Foldable.traverse_(Control_Monad_ST_Internal.applicativeST)(Data_Foldable.foldableArray);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Foreign_Object.foldableObject);
var applySecond = /* #__PURE__ */ Control_Apply.applySecond(Control_Monad_ST_Internal.applyST);
var Begin = /* #__PURE__ */ (function () {
    function Begin() {

    };
    Begin.value = new Begin();
    return Begin;
})();
var Middle = /* #__PURE__ */ (function () {
    function Middle() {

    };
    Middle.value = new Middle();
    return Middle;
})();
var End = /* #__PURE__ */ (function () {
    function End() {

    };
    End.value = new End();
    return End;
})();
var MutAr = function (x) {
    return x;
};
var switcher = function (f) {
    return function (event) {
        var counter = function (ev) {
            var fn = function (a) {
                return function (b) {
                    return new Data_Tuple.Tuple(a + 1 | 0, new Data_Tuple.Tuple(b, a));
                };
            };
            return mapAccum(fn)(0)(ev);
        };
        return new Bolson_Core["DynamicChildren$prime"](keepLatest(FRP_Event.memoize(counter(event))(function (cenv) {
            return map(function (v) {
                return merge([ map(Data_Function["const"](Bolson_Core.Remove.value))(filter((function () {
                    var $197 = eq(v.value1 + 1 | 0);
                    return function ($198) {
                        return $197(Data_Tuple.snd($198));
                    };
                })())(cenv)), pure(new Bolson_Core.Insert(f(v.value0))) ]);
            })(cenv);
        })));
    };
};
var internalPortalComplexSimple = function () {
    return function () {
        return function () {
            return function (isGlobal) {
                return function (scopeF) {
                    return function (v) {
                        return function (toBeam) {
                            return function (closure) {
                                var go = function (psr) {
                                    return function (interpreter) {
                                        return FRP_Event.makeLemmingEventO(function (v1, k) {
                                            var av = $foreign.mutAr(voidLeft(toArray(toBeam))({
                                                id: "",
                                                entity: new Bolson_Core["EventfulElement$prime"](empty)
                                            }))();
                                            var actualized = merge(mapWithIndex(function (ix) {
                                                return fix(function (f) {
                                                    return function (entity) {
                                                        if (entity instanceof Bolson_Core["Element$prime"]) {
                                                            return (function (v2) {
                                                                return v2((function () {
                                                                    var $100 = {};
                                                                    for (var $101 in psr) {
                                                                        if ({}.hasOwnProperty.call(psr, $101)) {
                                                                            $100[$101] = psr[$101];
                                                                        };
                                                                    };
                                                                    $100.parent = Data_Maybe.Nothing.value;
                                                                    $100.scope = scopeF(psr.scope);
                                                                    $100.raiseId = function (id) {
                                                                        return $foreign.unsafeUpdateMutAr(ix)({
                                                                            id: id,
                                                                            entity: entity
                                                                        })(av);
                                                                    };
                                                                    return $100;
                                                                })())(interpreter);
                                                            })(v.toEltO1(entity.value0));
                                                        };
                                                        return f(v.wrapElt(entity));
                                                    };
                                                });
                                            })(toArray(toBeam)));
                                            var u0 = v1(actualized, k);
                                            var av2 = Control_Monad_ST_Internal["new"](pure1(Data_Unit.unit))();
                                            var idz = map1(Unsafe_Coerce.unsafeCoerce)($foreign.readAr(av))();
                                            var injectable = map2(function (v2) {
                                                return function (specialization) {
                                                    return new Bolson_Core["Element$prime"](v.fromEltO1(function (psr2) {
                                                        return function (itp) {
                                                            return FRP_Event.makeLemmingEventO(function (v3, k2) {
                                                                psr2.raiseId(v2.id)();
                                                                for_1(psr2.parent)(function (pt) {
                                                                    return function () {
                                                                        return k2(v.giveNewParent(itp)(Record_Builder.build(composeFlipped(insert(Type_Proxy["Proxy"].value)(v2.id))(modify(Type_Proxy["Proxy"].value)(Data_Function["const"](pt))))(psr2))(v2.entity)(specialization));
                                                                    };
                                                                })();
                                                                return pure1(Data_Unit.unit);
                                                            });
                                                        };
                                                    }));
                                                };
                                            })(idz);
                                            var v2 = v.toEltO2(closure(injectable));
                                            var u = v1(v2(psr)(interpreter), k);
                                            $$void(Control_Monad_ST_Internal.write(u)(av2))();
                                            return function __do() {
                                                u0();
                                                when(!isGlobal)(for_2(toArray(idz))(function (v3) {
                                                    return function () {
                                                        return k(v.deleteFromCache(interpreter)({
                                                            id: v3.id
                                                        }));
                                                    };
                                                }))();
                                                var av2c = Control_Monad_ST_Internal.read(av2)();
                                                return av2c();
                                            };
                                        });
                                    };
                                };
                                return v.fromEltO2(go);
                            };
                        };
                    };
                };
            };
        };
    };
};
var internalPortalComplexSimple1 = /* #__PURE__ */ internalPortalComplexSimple()()();
var portalComplexSimple = function () {
    return function () {
        return function () {
            return function (portalArgs) {
                return function (toBeam) {
                    return function (closure) {
                        return internalPortalComplexSimple1(false)(identity)(portalArgs)(toBeam)(closure);
                    };
                };
            };
        };
    };
};
var globalPortalComplexSimple = function () {
    return function () {
        return function () {
            return function (portalArgs) {
                return function (toBeam) {
                    return function (closure) {
                        return internalPortalComplexSimple1(true)(Data_Function["const"](Bolson_Core.Global.value))(portalArgs)(toBeam)(closure);
                    };
                };
            };
        };
    };
};
var flatten = function (v) {
    return function (psr) {
        return function (interpreter) {
            var element = function (v1) {
                return v1(psr)(interpreter);
            };
            return function (v1) {
                if (v1 instanceof Bolson_Core["FixedChildren$prime"]) {
                    return merge(map3(flatten(v)(psr)(interpreter))(v1.value0));
                };
                if (v1 instanceof Bolson_Core["EventfulElement$prime"]) {
                    return keepLatest(map(flatten(v)(psr)(interpreter))(v1.value0));
                };
                if (v1 instanceof Bolson_Core["Element$prime"]) {
                    return element(v.toElt(v1.value0));
                };
                if (v1 instanceof Bolson_Core["DynamicChildren$prime"]) {
                    return FRP_Event.makeLemmingEventO(function (v2, v3) {
                        var cancelInner = Control_Monad_ST_Internal["new"](Foreign_Object.empty)();
                        var cancelOuter = v2(v1.value0, function (inner) {
                            var myUnsubId = v.ids(interpreter)();
                            var myUnsub = Control_Monad_ST_Internal["new"](pure1(Data_Unit.unit))();
                            var eltsUnsubId = v.ids(interpreter)();
                            var eltsUnsub = Control_Monad_ST_Internal["new"](pure1(Data_Unit.unit))();
                            var myIds = Control_Monad_ST_Internal["new"]([  ])();
                            var myImmediateCancellation = Control_Monad_ST_Internal["new"](pure1(Data_Unit.unit))();
                            var myScope = map1(Bolson_Core.Local.create)((function () {
                                if (psr.scope instanceof Bolson_Core.Global) {
                                    return v.ids(interpreter);
                                };
                                if (psr.scope instanceof Bolson_Core.Local) {
                                    return append(pure1(psr.scope.value0))(append(pure1("!"))(v.ids(interpreter)));
                                };
                                throw new Error("Failed pattern match at Bolson.Control (line 547, column 17 - line 549, column 67): " + [ psr.scope.constructor.name ]);
                            })())();
                            var stageRef = Control_Monad_ST_Internal["new"](Begin.value)();
                            var c0 = v2(inner, function (kid$prime) {
                                var stage = Control_Monad_ST_Internal.read(stageRef)();
                                if (kid$prime instanceof Bolson_Core.Logic && stage instanceof Middle) {
                                    var curId = Control_Monad_ST_Internal.read(myIds)();
                                    return traverse_(function (i) {
                                        return function () {
                                            return v3(v.doLogic(kid$prime.value0)(interpreter)(i));
                                        };
                                    })(curId)();
                                };
                                if (kid$prime instanceof Bolson_Core.Remove && stage instanceof Middle) {
                                    $$void(Control_Monad_ST_Internal.write(End.value)(stageRef))();
                                    var mic = function __do() {
                                        var idRef = Control_Monad_ST_Internal.read(myIds)();
                                        for_2(idRef)(function (old) {
                                            return for_1(psr.parent)(function (pnt) {
                                                return function () {
                                                    return v3(v.disconnectElement(interpreter)({
                                                        id: old,
                                                        parent: pnt,
                                                        scope: myScope
                                                    }));
                                                };
                                            });
                                        })();
                                        var myu = Control_Monad_ST_Internal.read(myUnsub)();
                                        myu();
                                        var eltu = Control_Monad_ST_Internal.read(eltsUnsub)();
                                        eltu();
                                        $$void(Control_Monad_ST_Internal.modify(Foreign_Object["delete"](myUnsubId))(cancelInner))();
                                        return $$void(Control_Monad_ST_Internal.modify(Foreign_Object["delete"](eltsUnsubId))(cancelInner))();
                                    };
                                    $$void(Control_Monad_ST_Internal.write(mic)(myImmediateCancellation))();
                                    return mic();
                                };
                                if (kid$prime instanceof Bolson_Core.Insert && stage instanceof Begin) {
                                    $$void(Control_Monad_ST_Internal.write(Middle.value)(stageRef))();
                                    var c1 = v2(flatten(v)((function () {
                                        var $132 = {};
                                        for (var $133 in psr) {
                                            if ({}.hasOwnProperty.call(psr, $133)) {
                                                $132[$133] = psr[$133];
                                            };
                                        };
                                        $132.scope = myScope;
                                        $132.raiseId = function (id) {
                                            return $$void(Control_Monad_ST_Internal.modify(append1([ id ]))(myIds));
                                        };
                                        return $132;
                                    })())(interpreter)(kid$prime.value0), v3);
                                    $$void(Control_Monad_ST_Internal.modify(Foreign_Object.insert(eltsUnsubId)(c1))(cancelInner))();
                                    return $$void(Control_Monad_ST_Internal.write(c1)(eltsUnsub))();
                                };
                                return Data_Unit.unit;
                            });
                            $$void(Control_Monad_ST_Internal.write(c0)(myUnsub))();
                            $$void(Control_Monad_ST_Internal.modify(Foreign_Object.insert(myUnsubId)(c0))(cancelInner))();
                            var mican = Control_Monad_ST_Internal.read(myImmediateCancellation)();
                            return mican();
                        });
                        return function __do() {
                            bind(Control_Monad_ST_Internal.read(cancelInner))(foldl(applySecond)(pure1(Data_Unit.unit)))();
                            return cancelOuter();
                        };
                    });
                };
                throw new Error("Failed pattern match at Bolson.Control (line 520, column 17 - line 610, column 20): " + [ v1.constructor.name ]);
            };
        };
    };
};
var internalPortalComplexComplex = function () {
    return function () {
        return function () {
            return function (isGlobal) {
                return function (scopeF) {
                    return function (flatArgs) {
                        return function (v) {
                            return function (toBeam) {
                                return function (closure) {
                                    var go = function (psr) {
                                        return function (interpreter) {
                                            return FRP_Event.makeLemmingEventO(function (v1, k) {
                                                var av = $foreign.mutAr(voidLeft(toArray(toBeam))({
                                                    id: "",
                                                    entity: new Bolson_Core["EventfulElement$prime"](empty)
                                                }))();
                                                var actualized = merge(mapWithIndex(function (ix) {
                                                    return fix(function (f) {
                                                        return function (entity) {
                                                            if (entity instanceof Bolson_Core["Element$prime"]) {
                                                                return (function (v2) {
                                                                    return v2((function () {
                                                                        var $150 = {};
                                                                        for (var $151 in psr) {
                                                                            if ({}.hasOwnProperty.call(psr, $151)) {
                                                                                $150[$151] = psr[$151];
                                                                            };
                                                                        };
                                                                        $150.parent = Data_Maybe.Nothing.value;
                                                                        $150.scope = scopeF(psr.scope);
                                                                        $150.raiseId = function (id) {
                                                                            return $foreign.unsafeUpdateMutAr(ix)({
                                                                                id: id,
                                                                                entity: entity
                                                                            })(av);
                                                                        };
                                                                        return $150;
                                                                    })())(interpreter);
                                                                })(v.toElt(entity.value0));
                                                            };
                                                            return f(v.wrapElt(entity));
                                                        };
                                                    });
                                                })(toArray(toBeam)));
                                                var u0 = v1(actualized, k);
                                                var av2 = Control_Monad_ST_Internal["new"](pure1(Data_Unit.unit))();
                                                var idz = map1(Unsafe_Coerce.unsafeCoerce)($foreign.readAr(av))();
                                                var injectable = map2(function (v2) {
                                                    return function (specialization) {
                                                        return new Bolson_Core["Element$prime"](v.fromEltO1(function (psr2) {
                                                            return function (itp) {
                                                                return FRP_Event.makeLemmingEventO(function (v3, k2) {
                                                                    psr2.raiseId(v2.id)();
                                                                    for_1(psr2.parent)(function (pt) {
                                                                        return function () {
                                                                            return k2(v.giveNewParent(itp)(Record_Builder.build(composeFlipped(insert(Type_Proxy["Proxy"].value)(v2.id))(modify(Type_Proxy["Proxy"].value)(Data_Function["const"](pt))))(psr2))(v2.entity)(specialization));
                                                                        };
                                                                    })();
                                                                    return pure1(Data_Unit.unit);
                                                                });
                                                            };
                                                        }));
                                                    };
                                                })(idz);
                                                var realized = flatten(flatArgs)(psr)(interpreter)(closure(injectable));
                                                var u = v1(realized, k);
                                                $$void(Control_Monad_ST_Internal.write(u)(av2))();
                                                return function __do() {
                                                    u0();
                                                    when(!isGlobal)(for_2(toArray(idz))(function (v2) {
                                                        return function () {
                                                            return k(v.deleteFromCache(interpreter)({
                                                                id: v2.id
                                                            }));
                                                        };
                                                    }))();
                                                    var av2c = Control_Monad_ST_Internal.read(av2)();
                                                    return av2c();
                                                };
                                            });
                                        };
                                    };
                                    return new Bolson_Core["Element$prime"](v.fromEltO2(go));
                                };
                            };
                        };
                    };
                };
            };
        };
    };
};
var internalPortalComplexComplex1 = /* #__PURE__ */ internalPortalComplexComplex()()();
var globalPortalComplexComplex = function () {
    return function () {
        return function () {
            return function (flatArgs) {
                return function (portalArgs) {
                    return function (toBeam) {
                        return function (closure) {
                            return internalPortalComplexComplex1(true)(Data_Function["const"](Bolson_Core.Global.value))(flatArgs)(portalArgs)(toBeam)(closure);
                        };
                    };
                };
            };
        };
    };
};
var portalComplexComplex = function () {
    return function () {
        return function () {
            return function (flatArgs) {
                return function (portalArgs) {
                    return function (toBeam) {
                        return function (closure) {
                            return internalPortalComplexComplex1(false)(identity)(flatArgs)(portalArgs)(toBeam)(closure);
                        };
                    };
                };
            };
        };
    };
};
var internalPortalSimpleComplex = function () {
    return function () {
        return function () {
            return function (isGlobal) {
                return function (scopeF) {
                    return function (flatArgs) {
                        return function (v) {
                            return function (toBeam) {
                                return function (closure) {
                                    var go = function (psr) {
                                        return function (interpreter) {
                                            return FRP_Event.makeLemmingEventO(function (v1, k) {
                                                var av = $foreign.mutAr(voidLeft(toArray(toBeam))({
                                                    id: "",
                                                    entity: new Bolson_Core["EventfulElement$prime"](empty)
                                                }))();
                                                var actualized = merge(mapWithIndex(function (ix) {
                                                    return function (entity) {
                                                        return (function (v2) {
                                                            return v2((function () {
                                                                var $173 = {};
                                                                for (var $174 in psr) {
                                                                    if ({}.hasOwnProperty.call(psr, $174)) {
                                                                        $173[$174] = psr[$174];
                                                                    };
                                                                };
                                                                $173.parent = Data_Maybe.Nothing.value;
                                                                $173.scope = scopeF(psr.scope);
                                                                $173.raiseId = function (id) {
                                                                    return $foreign.unsafeUpdateMutAr(ix)({
                                                                        id: id,
                                                                        entity: new Bolson_Core["Element$prime"](entity)
                                                                    })(av);
                                                                };
                                                                return $173;
                                                            })())(interpreter);
                                                        })(v.toElt(entity));
                                                    };
                                                })(toArray(toBeam)));
                                                var u0 = v1(actualized, k);
                                                var av2 = Control_Monad_ST_Internal["new"](pure1(Data_Unit.unit))();
                                                var idz = map1(Unsafe_Coerce.unsafeCoerce)($foreign.readAr(av))();
                                                var injectable = map2(function (v2) {
                                                    return function (specialization) {
                                                        return v.fromEltO1(function (psr2) {
                                                            return function (itp) {
                                                                return FRP_Event.makeLemmingEventO(function (v3, k2) {
                                                                    psr2.raiseId(v2.id)();
                                                                    for_1(psr2.parent)(function (pt) {
                                                                        return function () {
                                                                            return k2(v.giveNewParent(itp)(Record_Builder.build(composeFlipped(insert(Type_Proxy["Proxy"].value)(v2.id))(modify(Type_Proxy["Proxy"].value)(Data_Function["const"](pt))))(psr2))(v2.entity)(specialization));
                                                                        };
                                                                    })();
                                                                    return pure1(Data_Unit.unit);
                                                                });
                                                            };
                                                        });
                                                    };
                                                })(idz);
                                                var realized = flatten(flatArgs)(psr)(interpreter)(closure(injectable));
                                                var u = v1(realized, k);
                                                $$void(Control_Monad_ST_Internal.write(u)(av2))();
                                                return function __do() {
                                                    u0();
                                                    when(!isGlobal)(for_2(toArray(idz))(function (v2) {
                                                        return function () {
                                                            return k(v.deleteFromCache(interpreter)({
                                                                id: v2.id
                                                            }));
                                                        };
                                                    }))();
                                                    var av2c = Control_Monad_ST_Internal.read(av2)();
                                                    return av2c();
                                                };
                                            });
                                        };
                                    };
                                    return new Bolson_Core["Element$prime"](v.fromEltO2(go));
                                };
                            };
                        };
                    };
                };
            };
        };
    };
};
var internalPortalSimpleComplex1 = /* #__PURE__ */ internalPortalSimpleComplex()()();
var globalPortalSimpleComplex = function () {
    return function () {
        return function () {
            return function (flatArgs) {
                return function (portalArgs) {
                    return function (toBeam) {
                        return function (closure) {
                            return internalPortalSimpleComplex1(true)(Data_Function["const"](Bolson_Core.Global.value))(flatArgs)(portalArgs)(toBeam)(closure);
                        };
                    };
                };
            };
        };
    };
};
var portalSimpleComplex = function () {
    return function () {
        return function () {
            return function (flatArgs) {
                return function (portalArgs) {
                    return function (toBeam) {
                        return function (closure) {
                            return internalPortalSimpleComplex1(false)(identity)(flatArgs)(portalArgs)(toBeam)(closure);
                        };
                    };
                };
            };
        };
    };
};
var fixComplexComplex = function (flatArgs) {
    return function (v) {
        return function (f) {
            var go = function (i) {
                return function (interpret) {
                    return FRP_Event.makeLemmingEventO(function (v1, k) {
                        var av = Control_Monad_ST_Internal["new"](Data_Maybe.Nothing.value)();
                        var nn = f(new Bolson_Core["Element$prime"](v.fromElt(function (ii) {
                            return function (v2) {
                                return FRP_Event.makeLemmingEventO(function (v3, k0) {
                                    (function __do() {
                                        var v4 = Control_Monad_ST_Internal.read(av)();
                                        if (v4 instanceof Data_Maybe.Nothing) {
                                            return Data_Unit.unit;
                                        };
                                        if (v4 instanceof Data_Maybe.Just) {
                                            return for_1(ii.parent)(function (p$prime) {
                                                return when(v4.value0 !== p$prime)(function __do() {
                                                    ii.raiseId(v4.value0)();
                                                    return k0(v.connectToParent(interpret)({
                                                        id: v4.value0,
                                                        parent: p$prime
                                                    }));
                                                });
                                            })();
                                        };
                                        throw new Error("Failed pattern match at Bolson.Control (line 635, column 27 - line 643, column 16): " + [ v4.constructor.name ]);
                                    })();
                                    return pure1(Data_Unit.unit);
                                });
                            };
                        })));
                        return v1(flatten(flatArgs)((function () {
                            var $192 = {};
                            for (var $193 in i) {
                                if ({}.hasOwnProperty.call(i, $193)) {
                                    $192[$193] = i[$193];
                                };
                            };
                            $192.parent = i.parent;
                            $192.scope = i.scope;
                            $192.raiseId = function (s) {
                                return function __do() {
                                    i.raiseId(s)();
                                    return $$void(Control_Monad_ST_Internal.write(new Data_Maybe.Just(s))(av))();
                                };
                            };
                            return $192;
                        })())(interpret)(nn), k);
                    });
                };
            };
            return new Bolson_Core["Element$prime"](v.fromElt(go));
        };
    };
};
export {
    flatten,
    globalPortalComplexComplex,
    globalPortalSimpleComplex,
    globalPortalComplexSimple,
    portalComplexComplex,
    portalSimpleComplex,
    portalComplexSimple,
    fixComplexComplex,
    switcher
};
