// Generated by purs version 0.13.3
"use strict";
var Control_Alt = require("../Control.Alt/index.js");
var Control_Alternative = require("../Control.Alternative/index.js");
var Control_Applicative = require("../Control.Applicative/index.js");
var Control_Apply = require("../Control.Apply/index.js");
var Control_Bind = require("../Control.Bind/index.js");
var Control_Plus = require("../Control.Plus/index.js");
var Data_Array = require("../Data.Array/index.js");
var Data_Compactable = require("../Data.Compactable/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_Filterable = require("../Data.Filterable/index.js");
var Data_Foldable = require("../Data.Foldable/index.js");
var Data_Function = require("../Data.Function/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_HeytingAlgebra = require("../Data.HeytingAlgebra/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Data_Monoid = require("../Data.Monoid/index.js");
var Data_Semigroup = require("../Data.Semigroup/index.js");
var Data_Unit = require("../Data.Unit/index.js");
var Effect = require("../Effect/index.js");
var Effect_Ref = require("../Effect.Ref/index.js");
var Effect_Unsafe = require("../Effect.Unsafe/index.js");
var FRP_Event_Class = require("../FRP.Event.Class/index.js");
var Unsafe_Reference = require("../Unsafe.Reference/index.js");
var Event = function (x) {
    return x;
};
var subscribe = function (v) {
    return function (k) {
        return v((function () {
            var $79 = Data_Functor["void"](Effect.functorEffect);
            return function ($80) {
                return $79(k($80));
            };
        })());
    };
};
var sampleOn = function (v) {
    return function (v1) {
        return function (k) {
            return function __do() {
                var v2 = Effect_Ref["new"](Data_Maybe.Nothing.value)();
                var v3 = v(function (a) {
                    return Effect_Ref.write(new Data_Maybe.Just(a))(v2);
                })();
                var v4 = v1(function (f) {
                    return Control_Bind.bind(Effect.bindEffect)(Effect_Ref.read(v2))(Data_Foldable.traverse_(Effect.applicativeEffect)(Data_Foldable.foldableMaybe)(function ($81) {
                        return k(f($81));
                    }));
                })();
                return Control_Apply.applySecond(Effect.applyEffect)(v3)(v4);
            };
        };
    };
};
var makeEvent = Event;
var keepLatest = function (v) {
    return function (k) {
        return function __do() {
            var v1 = Effect_Ref["new"](Data_Maybe.Nothing.value)();
            var v2 = v(function (inner) {
                return function __do() {
                    Control_Bind.bind(Effect.bindEffect)(Effect_Ref.read(v1))(Data_Foldable.sequence_(Effect.applicativeEffect)(Data_Foldable.foldableMaybe))();
                    var v2 = subscribe(inner)(k)();
                    return Effect_Ref.write(new Data_Maybe.Just(v2))(v1)();
                };
            })();
            return function __do() {
                Control_Bind.bind(Effect.bindEffect)(Effect_Ref.read(v1))(Data_Foldable.sequence_(Effect.applicativeEffect)(Data_Foldable.foldableMaybe))();
                return v2();
            };
        };
    };
};
var functorEvent = new Data_Functor.Functor(function (f) {
    return function (v) {
        return function (k) {
            return v(function ($82) {
                return k(f($82));
            });
        };
    };
});
var fold = function (f) {
    return function (v) {
        return function (b) {
            return function (k) {
                return function __do() {
                    var v1 = Effect_Ref["new"](b)();
                    return v(function (a) {
                        return Control_Bind.bind(Effect.bindEffect)(Effect_Ref.modify(f(a))(v1))(k);
                    })();
                };
            };
        };
    };
};
var filter = function (p) {
    return function (v) {
        return function (k) {
            return v(function (a) {
                var $59 = p(a);
                if ($59) {
                    return k(a);
                };
                return Control_Applicative.pure(Effect.applicativeEffect)(Data_Unit.unit);
            });
        };
    };
};
var create = function __do() {
    var v = Effect_Ref["new"]([  ])();
    return {
        event: function (k) {
            return function __do() {
                var v1 = Effect_Ref.modify(function (v1) {
                    return Data_Semigroup.append(Data_Semigroup.semigroupArray)(v1)([ k ]);
                })(v)();
                return function __do() {
                    var v2 = Effect_Ref.modify(Data_Array.deleteBy(Unsafe_Reference.unsafeRefEq)(k))(v)();
                    return Data_Unit.unit;
                };
            };
        },
        push: function (a) {
            return Control_Bind.bind(Effect.bindEffect)(Effect_Ref.read(v))(Data_Foldable.traverse_(Effect.applicativeEffect)(Data_Foldable.foldableArray)(function (k) {
                return k(a);
            }));
        }
    };
};
var fix = function (f) {
    var v = Effect_Unsafe.unsafePerformEffect(create);
    var v1 = f(v.event);
    return function (k) {
        return function __do() {
            var v2 = subscribe(v1.input)(v.push)();
            var v3 = subscribe(v1.output)(k)();
            return Control_Apply.applySecond(Effect.applyEffect)(v2)(v3);
        };
    };
};
var compactableEvent = new Data_Compactable.Compactable(function (xs) {
    return Data_Functor.map(functorEvent)(function (x) {
        return Data_Maybe.fromJust()(x);
    })(filter(Data_Maybe.isJust)(xs));
}, function (xs) {
    return {
        left: Data_Functor.map(functorEvent)(Data_Either.fromLeft())(filter(Data_Either.isLeft)(xs)),
        right: Data_Functor.map(functorEvent)(Data_Either.fromRight())(filter(Data_Either.isRight)(xs))
    };
});
var filterableEvent = new Data_Filterable.Filterable(function () {
    return compactableEvent;
}, function () {
    return functorEvent;
}, filter, function (f) {
    var $83 = Data_Functor.map(functorEvent)(function (x) {
        return Data_Maybe.fromJust()(x);
    });
    var $84 = filter(Data_Maybe.isJust);
    var $85 = Data_Functor.map(functorEvent)(f);
    return function ($86) {
        return $83($84($85($86)));
    };
}, function (p) {
    return function (xs) {
        return {
            yes: filter(p)(xs),
            no: filter((function () {
                var $87 = Data_HeytingAlgebra.not(Data_HeytingAlgebra.heytingAlgebraBoolean);
                return function ($88) {
                    return $87(p($88));
                };
            })())(xs)
        };
    };
}, function (f) {
    return function (xs) {
        return {
            left: Data_Filterable.filterMap(filterableEvent)((function () {
                var $89 = Data_Either.either(Data_Maybe.Just.create)(Data_Function["const"](Data_Maybe.Nothing.value));
                return function ($90) {
                    return $89(f($90));
                };
            })())(xs),
            right: Data_Filterable.filterMap(filterableEvent)(function ($91) {
                return Data_Either.hush(f($91));
            })(xs)
        };
    };
});
var applyEvent = new Control_Apply.Apply(function () {
    return functorEvent;
}, function (v) {
    return function (v1) {
        return function (k) {
            return function __do() {
                var v2 = Effect_Ref["new"](Data_Maybe.Nothing.value)();
                var v3 = Effect_Ref["new"](Data_Maybe.Nothing.value)();
                var v4 = v(function (a) {
                    return function __do() {
                        Effect_Ref.write(new Data_Maybe.Just(a))(v2)();
                        return Control_Bind.bind(Effect.bindEffect)(Effect_Ref.read(v3))(Data_Foldable.traverse_(Effect.applicativeEffect)(Data_Foldable.foldableMaybe)(function ($92) {
                            return k(a($92));
                        }))();
                    };
                })();
                var v5 = v1(function (b) {
                    return function __do() {
                        Effect_Ref.write(new Data_Maybe.Just(b))(v3)();
                        return Control_Bind.bind(Effect.bindEffect)(Effect_Ref.read(v2))(Data_Foldable.traverse_(Effect.applicativeEffect)(Data_Foldable.foldableMaybe)(function ($93) {
                            return k((function (v5) {
                                return v5(b);
                            })($93));
                        }))();
                    };
                })();
                return Control_Apply.applySecond(Effect.applyEffect)(v4)(v5);
            };
        };
    };
});
var semigroupEvent = function (dictSemigroup) {
    return new Data_Semigroup.Semigroup(Control_Apply.lift2(applyEvent)(Data_Semigroup.append(dictSemigroup)));
};
var applicativeEvent = new Control_Applicative.Applicative(function () {
    return applyEvent;
}, function (a) {
    return function (k) {
        return function __do() {
            k(a)();
            return Control_Applicative.pure(Effect.applicativeEffect)(Data_Unit.unit);
        };
    };
});
var monoidEvent = function (dictMonoid) {
    return new Data_Monoid.Monoid(function () {
        return semigroupEvent(dictMonoid.Semigroup0());
    }, Control_Applicative.pure(applicativeEvent)(Data_Monoid.mempty(dictMonoid)));
};
var altEvent = new Control_Alt.Alt(function () {
    return functorEvent;
}, function (v) {
    return function (v1) {
        return function (k) {
            return function __do() {
                var v2 = v(k)();
                var v3 = v1(k)();
                return Control_Apply.applySecond(Effect.applyEffect)(v2)(v3);
            };
        };
    };
});
var plusEvent = new Control_Plus.Plus(function () {
    return altEvent;
}, function (v) {
    return Control_Applicative.pure(Effect.applicativeEffect)(Control_Applicative.pure(Effect.applicativeEffect)(Data_Unit.unit));
});
var alternativeEvent = new Control_Alternative.Alternative(function () {
    return applicativeEvent;
}, function () {
    return plusEvent;
});
var eventIsEvent = new FRP_Event_Class.IsEvent(function () {
    return alternativeEvent;
}, function () {
    return filterableEvent;
}, fix, fold, keepLatest, sampleOn);
module.exports = {
    create: create,
    makeEvent: makeEvent,
    subscribe: subscribe,
    functorEvent: functorEvent,
    compactableEvent: compactableEvent,
    filterableEvent: filterableEvent,
    applyEvent: applyEvent,
    applicativeEvent: applicativeEvent,
    altEvent: altEvent,
    plusEvent: plusEvent,
    alternativeEvent: alternativeEvent,
    semigroupEvent: semigroupEvent,
    monoidEvent: monoidEvent,
    eventIsEvent: eventIsEvent
};
